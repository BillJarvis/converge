all: libcompiler.cvl convergec convergel convergep

OBJECT_FILES = Compiler/CV_Parser.cvb Compiler/Tokenizer.cvb Compiler/init.cvb \
	Compiler/convergec.cvb Compiler/convergep.cvb Compiler/IModule_Gen.cvb \
	Compiler/ITree.cvb Compiler/Bytecode_Gen.cvb Compiler/Targets/Thirty_Two_Bit.cvb \
	Compiler/Targets/init.cvb Compiler/Compiler_Vars.cvb Compiler/CV_Module.cvb \
	Compiler/QQ_Mode.cvb Compiler/ITree_Format.cvb Compiler/ITree_TC.cvb \
	Compiler/CEI.cvb Compiler/convergel.cvb Compiler/CV_Library.cvb \
	Compiler/CV_Exec.cvb Compiler/Eval.cvb Compiler/Targets/Sixty_Four_Bit.cvb \
	Compiler/Targets/Available.cvb

include @abs_top_srcdir@/Makefile.inc

CONVERGEC_FLAGS += --bootstrap


ifdef TARGET
CROSS_OBJECTS = ${OBJECT_FILES:.cvb=.${TARGET}.cvb}

cross: ${CROSS_OBJECTS} ${CONVERGE_LIB_DIR}/libconverge.${TARGET}.cvl
	${CONVERGE_VM} ${CONVERGEL} -T ${TARGET} -o convergec.${TARGET} Compiler/convergec.${TARGET}.cvb ${CROSS_OBJECTS} ${CONVERGE_LIB_DIR}/libconverge.${TARGET}.cvl
	${CONVERGE_VM} ${CONVERGEL} -T ${TARGET} -o convergel.${TARGET} Compiler/convergel.${TARGET}.cvb ${CROSS_OBJECTS} ${CONVERGE_LIB_DIR}/libconverge.${TARGET}.cvl

cross-clean:
	rm -f ${CROSS_OBJECTS} convergec.${TARGET} convergel.${TARGET}
endif

libcompiler.cvl: ${OBJECT_FILES}
	${CONVERGE_VM} ${CONVERGEL} -l -o libcompiler.cvl ${OBJECT_FILES}

convergec: ${OBJECT_FILES} ${CONVERGE_LIB}
	${CONVERGE_VM} ${CONVERGEL} -o convergec Compiler/convergec.cvb ${OBJECT_FILES} ${CONVERGE_LIB}

convergel: ${OBJECT_FILES} ${CONVERGE_LIB}
	${CONVERGE_VM} ${CONVERGEL} -o convergel Compiler/convergel.cvb ${OBJECT_FILES} ${CONVERGE_LIB}

convergep: ${OBJECT_FILES} ${CONVERGE_LIB}
	${CONVERGE_VM} ${CONVERGEL} -o convergep Compiler/convergep.cvb ${OBJECT_FILES} ${CONVERGE_LIB}

clean:
	rm -f libcompiler.cvl ${OBJECT_FILES}

distclean: clean
	rm -f Makefile convergec convergel convergep
