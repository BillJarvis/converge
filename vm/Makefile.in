CC=@CC@
CFLAGS=@CFLAGS@
LIBS=@LIBS@
prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@

.SUFFIXES: .c .S .o

.c.o:
	${CC} ${CFLAGS} -I. -I/usr/local/include -c -o $@ $<

.S.o:
	${AS} -o $@ $<


OBJECT_FILES = 	@CON_THREAD_ATOM_OBJ@ @CON_THREAD_CLASS_OBJ@ @CON_THREAD_MODULE_OBJ@ \
	Bootstrap.o Target.o Builtins/Atom_Def_Atom.o Builtins/Class/Atom.o \
	Builtins/Class/Class.o Builtins/Closure/Atom.o Builtins/Closure/Class.o \
	Builtins/Con_Stack/Atom.o Builtins/Con_Stack/Class.o Builtins/Dict/Atom.o \
	Builtins/Dict/Class.o Builtins/Exception/Atom.o Builtins/Exception/Class.o \
	Builtins/Func/Atom.o Builtins/Func/Class.o Builtins/Int/Atom.o \
	Builtins/Int/Class.o Builtins/List/Atom.o Builtins/List/Class.o \
	Builtins/Module/Atom.o Builtins/Module/Class.o Builtins/Object/Class.o \
	Builtins/Partial_Application/Atom.o Builtins/Partial_Application/Class.o \
	Builtins/Set/Atom.o Builtins/Set/Class.o \
	Builtins/Slots_Atom_Def.o Builtins/String/Atom.o Builtins/String/Class.o \
	Builtins/Unique_Atom_Def.o Builtins/VM/Atom.o Builtins/VM/Class.o Bytecode.o \
	Builtins/Number/Class.o Builtins/Float/Atom.o Builtins/Float/Class.o \
	Hash.o Memory.o Misc.o Modules/Array.o Modules/Builtins.o Modules/C_Earley_Parser.o \
	Modules/C_Strings.o Modules/VM.o \
	Modules/Exceptions.o Modules/PCRE.o Modules/Sys.o Numbers.o Object.o \
	Platform/Arch/@CON_ARCH@/Arch.o @CON_MEMMOVE@ \
	Platform/POSIX/POSIX_File_Module.o Slots.o main.o Modules/Thread.o Modules/libXML2.o \
	Modules/Random.o Modules/C_Platform_Properties.o Modules/C_Platform_Env.o \
	Modules/C_Platform_Exec.o @FGETLN@
	

all: converge

install:
	install -d ${bindir}
	install -c -m 555 converge ${bindir}

sinclude .depend

depend:
	rm -f .depend
	echo ${OBJECT_FILES} | sed "y/ /\n/" | sed "s/\.o$$/.c/" | xargs mkdep -I. -I/usr/local/include -a ${CFLAGS}

libconverge.a: ${OBJECT_FILES}
	rm -f libconverge.a
	ar cru libconverge.a ${OBJECT_FILES}
	ranlib libconverge.a

converge: libconverge.a
	gcc -o converge main.o libconverge.a ${LIBS}

clean:
	rm -rf *.core libconverge.a converge ${OBJECT_FILES}

distclean: clean
	rm -f .depend Makefile Config.h Config.h.in Version.h
