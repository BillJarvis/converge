include @abs_top_srcdir@/Makefile.inc

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
datarootdir = @datarootdir@
datadir = @datadir@
condocsdir = ${datadir}/doc/converge-@CONVERGE_VERSION@
INSTALL = @INSTALL@


MANUALS = cvd/Array.cvd cvd/Builtins.cvd cvd/CEI.cvd \
	cvd/CPK.Earley.DSL.cvd cvd/Exceptions.cvd cvd/File.cvd \
	cvd/Functional.cvd cvd/Maths.cvd cvd/PCRE.cvd \
	cvd/Platform.Env.cvd cvd/Platform.Properties.cvd cvd/Platform.Exec.cvd \
	cvd/Platform.Host.cvd cvd/Random.cvd cvd/Sort.cvd cvd/Sys.cvd \
	cvd/Strings.cvd cvd/VM.cvd cvd/XML.Nodes.cvd cvd/XML.XDM.cvd \
	cvd/XML.XHTML.cvd


%.cvb: %.cv
	${CONVERGE_VM} ${CONVERGEC} -o $@ $<


all: cvd_to_html
	${CONVERGE_VM} cvd_to_html -o html ${subst /,@CON_DIR_SEP@,${MANUALS}}

install:
	${INSTALL} -d ${DESTDIR}${bindir}
	${INSTALL} -c -m 555 cvd_to_html ${DESTDIR}${bindir}
ifeq (@PLATFORM@, MinGW)
	${INSTALL} -c -m 555 ../../platform/MinGW/cvd_to_html.bat ${DESTDIR}${bindir}
endif
	${INSTALL} -d ${DESTDIR}${condocsdir}/modules_html
	${INSTALL} -c -m 444 html/*.html ${DESTDIR}${condocsdir}/modules_html

cvd_to_html: cvd_to_html.cvb ${CONVERGE_LIB}
	${CONVERGE_VM} ${CONVERGEL} -o cvd_to_html cvd_to_html.cvb

clean:
	rm -f cvd_to_html cvd_to_html.cvb html/*.html

distclean: clean
	rm -f Makefile
