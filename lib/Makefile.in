prefix = @prefix@
exec_prefix = @exec_prefix@
libdir = @libdir@
conlibdir = ${libdir}/converge-@CONVERGE_VERSION@

MINIMAL_OBJS = CPK/Earley/Grammar.cvb CPK/Earley/Parser.cvb CPK/Token.cvb CPK/Tokens.cvb \
	CPK/Tree.cvb File.cvb Functional.cvb Maths.cvb Numbers.cvb Parse_Options.cvb \
	Platform/Properties.cvb Strings.cvb Time.cvb

ALL_OBJS = ${MINIMAL_OBJS} \
	CEI.cvb CPK/Traverser.cvb Platform/Env.cvb Platform/Exec.cvb Sort.cvb \
	XML/Nodes.cvb XML/XDM.cvb XML/XHTML.cvb

all: libconverge.cvl

minimal: ${MINIMAL_OBJS}
	${CONVERGE_VM} ${CONVERGEL} -l -o libconverge.cvl ${MINIMAL_OBJS}

install: all
	install -d ${conlibdir}
	install -d ${conlibdir}/CPK
	install -d ${conlibdir}/CPK/Earley
	install -d ${conlibdir}/Platform
	install -d ${conlibdir}/XML
	echo ${ALL_OBJS:.cvb=.cv} | xargs -n 1 -I{} install -c -m 444 {} ${conlibdir}/{}
	install -c -m 444 libconverge.cvl ${conlibdir}

include @abs_top_srcdir@/Makefile.inc

CONVERGEC_FLAGS += --bootstrap

ifdef TARGET
CROSS_OBJS = ${ALL_OBJS:.cvb=.${TARGET}.cvb}

cross: ${CROSS_OBJS}
	${CONVERGE_VM} ${CONVERGEL} -l -T ${TARGET} -o libconverge.${TARGET}.cvl ${CROSS_OBJS}

cross-clean:
	rm -f ${CROSS_OBJS} libconverge.${TARGET}.cvl
endif


libconverge.cvl: ${ALL_OBJS}
	${CONVERGE_VM} ${CONVERGEL} -l -o libconverge.cvl ${ALL_OBJS}

clean:
	rm -f ${ALL_OBJS} libconverge.cvl

distclean: clean
	rm -f Makefile .depend
